"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var KOS=function(){function e(t){var i=this;_classCallCheck(this,e);var r={s:[],wt:$(window).scrollTop(),wb:$(window).scrollTop()+$(window).height(),wh:$(window).height()};Object.assign(r,t),Object.assign(this,r),0!=this.s.length&&this.s.forEach(function(e){$(e.item).each(function(){var t=this;$(this).css({transitionDuration:"0s"}),$(this).attr("data-kos-position",e.position),$(this).attr("data-kos-loop",e.loop),$(this).addClass("kos--"+e.kos),setTimeout(function(){$(t).css({transitionDuration:""})},100)})}),setTimeout(function(){i.update()},200);var s=this;$(window).scroll(function(){s.update()})}return _createClass(e,[{key:"update",value:function(){this.wh=$(window).height(),this.wt=$(window).scrollTop(),this.wb=this.wt+this.wh;var e=this;$('[class*="kos--"]').each(function(t){$(this).each(function(){var t=$(this).offset().top,i=t+$(this).height(),r=$(this).data("kos-position"),s=$(this).data("kos-loop");switch(r){case"top":r=18;break;case"bottom":r=1;break;case"center":r=10;break;default:r="string"!=typeof r?r:2}e.wb-e.wh/20*r>t&&e.wt+e.wh/20*r<i?$(this).addClass("kos--animated"):s&&$(this).removeClass("kos--animated")})})}}]),e}();function is(e){return $(e).is(e)}function type_text(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.el,i=void 0===t?".type-text":t,r=e.time,s=void 0===r?200:r;$(i).each(function(){var e="";$(this).text().trim().split("").forEach(function(t){e+=" "==t?'<span class="letter empty"></span>':'<span class="letter">'+t+"</span>"}),$(this).html('<span class="type-text-row">'+e+'<span class="line"></span></span>')}),$(".type-text-row").watchScroll({offset:.1,callback:function(){var e=$(this),t=e.find(".letter");setTimeout(function(){t.each(function(i){var r=this;setTimeout(function(){$(r).css({display:"block",visibility:"visible",width:"auto"}),i+1==t.length&&e.find(".line").hide()},i*s)})},300)}})}function count_text(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.el,i=void 0===t?".count-text":t,r=e.stepTime,s=void 0===r?10:r,a=e.duration,o=void 0===a?2e3:a;$(i).each(function(){var e=parseInt($(this).text());$(this).html('<span class="count-text-row" data-count="'+e+'">0+</span>')}),$(".count-text-row").watchScroll({offset:.2,callback:function(){var e=$(this),t=e.data("count"),i=0,r=o/s,a=Math.ceil(t/r),n=setInterval(function(){(i+=a)>=t&&(i=t,clearInterval(n)),e.text(i+"+")},s)}})}function showAlert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,i=void 0===t?"提示":t,r=e.text,s=void 0===r?"":r,a=e.icon,o=void 0===a?"info":a,n=e.timer,c=void 0===n?1e3:n,l=e.confirmButton,h=void 0!==l&&l,m=e.cancelButton,u=void 0!==m&&m,p=e.willClose,f=void 0===p?null:p;Swal.fire({title:i,text:s,icon:o,timer:c,timerProgressBar:!0,showConfirmButton:h,showCancelButton:u,willClose:"function"==typeof f?f:void 0})}function showNotication(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,i=void 0===t?"提示":t,r=e.text,s=void 0===r?"1秒後自動關閉":r,a=e.willClose;showAlert({title:i,text:s,icon:"warning",willClose:void 0===a?null:a})}function showError(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,i=void 0===t?"操作失敗":t,r=e.text,s=void 0===r?"1秒後自動關閉":r,a=e.willClose;showAlert({title:i,text:s,icon:"error",willClose:void 0===a?null:a})}function showSuccess(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,i=void 0===t?"操作成功":t,r=e.text,s=void 0===r?"1秒後自動關閉":r,a=e.willClose;showAlert({title:i,text:s,icon:"success",willClose:void 0===a?null:a})}function showConfirm(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,i=void 0===t?"注意":t,r=e.text,s=void 0===r?"":r,a=e.then,o=void 0===a?null:a;Swal.fire({title:i,text:s,icon:"warning",showDenyButton:!0,confirmButtonText:"確認",denyButtonText:"取消"}).then(function(e){e.isConfirmed&&"function"==typeof o&&o()})}$.fn.watchClass=function(e){return this.each(function(){var t=this,i=$(this),r=new MutationObserver(function(r){r.forEach(function(r){"class"===r.attributeName&&e.call(t,i.attr("class"))})});r.observe(t,{attributes:!0,attributeFilter:["class"]}),i.data("classObserver",r)})},$.fn.unwatchClass=function(){return this.each(function(){var e=$(this).data("classObserver");e&&e.disconnect()})},$.fn.watchScroll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=$.extend({offset:.15,once:!0,callback:null},e),i=this;function r(){var e=$(window).scrollTop(),r=$(window).height(),s=e+r;i.each(function(){var i=$(this);if(!t.once||!i.hasClass("scroll-active")){var a=i.offset().top,o=a+i.outerHeight();e+r*t.offset<=a&&s-r*t.offset>=o&&(i.addClass("scroll-active"),"function"==typeof t.callback&&t.callback.call(this),i.trigger("scrollin"))}})}return $(window).on("scroll.watchScroll resize.watchScroll",r),r(),this};var AccountSharing=function(){function e(t){var i=this;_classCallCheck(this,e);var r={members:[],purchase:[],options:{sharing:["家庭人數","家庭"]},html:{member:'<div class="group card py-2 px-3 bg-light d-flex flex-row justify-content-between align-items-center gap-3 animate__animated animate__fadeIn"><p class="m-0">{{title}}<span class="d-block fs-small text-secondary">分帳人數：{{qty}} 人</span></p><button type="button" class="delete btn btn-sm btn-danger" data-idx="{{idx}}"><i class="bi bi-trash-fill"></i></button></div>',purchase:'<div class="group card py-2 px-3 bg-light d-flex flex-row justify-content-between align-items-center gap-3 animate__animated animate__fadeIn"><p class="m-0">{{title}}<span class="d-block fs-small text-secondary">付費家庭/成員：{{member}}｜費用：{{price}}｜分帳方式：{{sharing}}</span></p><button type="button" class="delete btn btn-sm btn-danger" data-idx="{{idx}}"><i class="bi bi-trash-fill"></i></button></div>',history:'<div class="group alert alert-warning py-2 px-3 m-0 row g-3 align-items-center animate__animated animate__fadeIn"><p class="m-0 col-4">{{from}}</p><p class="m-0 text-center col-4">{{price}}<br><i class="bi bi-arrow-right"></i></p><p class="m-0 col-4 text-end">{{to}}</p></div>'}};Object.assign(r,t),Object.assign(this,r),this.init(),this.memberController(),this.purchaseController(),$("#reset").on("click",function(){showConfirm({text:"確認要重置已新增內容？",then:function(){i.members=[],i.purchase=[],i.resetHtml(),i.updatePurchaseMemberOptions(),i.updateMemberCost(),i.updateTotal()}})})}return _createClass(e,[{key:"init",value:function(){var e=this;if(this.members.length>0){$("#member-list .empty").hide();var t=this.html.member;this.members.forEach(function(e){var i=t.replace(/{{title}}/g,e.title).replace(/{{qty}}/g,e.qty).replace(/{{idx}}/g,e.idx);$("#member-list").append(i)})}if(this.purchase.length>0){$("#purchase-list .empty").hide();var i=this.html.purchase;this.purchase.forEach(function(t){var r=e.getMemberName(t.member),s=i.replace(/{{title}}/g,t.title).replace(/{{price}}/g,t.price).replace(/{{member}}/g,r).replace(/{{sharing}}/g,e.options.sharing[t.sharing]).replace(/{{idx}}/g,t.idx);$("#purchase-list").append(s)})}this.updatePurchaseMemberOptions(),this.updateMemberCost(),this.updateTotal()}},{key:"memberController",value:function(){var e=this;$("#add-member").on("click",function(){var t={member_title:$("#member-title").val().trim(),member_qty:$("#member-qty").val().trim()};if($("#add-member-form .form-control").removeClass("is-invalid"),""==t.member_title||""==t.member_qty)return showError({text:"請填寫家庭成員、分擔人數",willClose:function(){""==t.member_title&&$("#member-title").addClass("is-invalid"),""==t.member_qty&&$("#member-qty").addClass("is-invalid")}});var i=e.members.length,r=e.html.member.replace(/{{title}}/g,t.member_title).replace(/{{qty}}/g,t.member_qty).replace(/{{idx}}/g,i);$("#member-list .empty").hide(),$("#member-list").append(r),e.members.push({idx:i,title:t.member_title,qty:t.member_qty,cost:0}),$("#member-title, #member-qty").val(""),e.updatePurchaseMemberOptions(),e.updateMemberCost()}),$(document).on("click","#member-list .group .delete",function(){var t=this;showConfirm({title:"是否要刪除此成員？",text:"刪除後會將此家庭/成員的消費項目一並刪除",then:function(){var i=$(t).data("idx");e.members.forEach(function(r,s){r.idx==i&&($(t).closest(".group").remove(),e.members.splice(s,1))}),0==e.members.length&&$("#member-list .empty").show(),e.updatePurchaseMemberOptions(),e.cleanPurchase(i),e.updateMemberCost()}})})}},{key:"purchaseController",value:function(){var e=this;$("#add-purchase").on("click",function(){var t={purchase_title:$("#purchase-title").val().trim(),purchase_price:$("#purchase-price").val().trim(),purchase_member:$("#purchase-member").val().trim(),purchase_sharing:$("#purchase-sharing").val().trim()};if($("#add-purchase-form .form-control, #add-purchase-form .form-select").removeClass("is-invalid"),""==t.purchase_title||""==t.purchase_price||""==t.purchase_member||""==t.purchase_sharing)return showError({text:"請正確填寫內容",willClose:function(){""==t.purchase_title&&$("#purchase-title").addClass("is-invalid"),""==t.purchase_price&&$("#purchase-price").addClass("is-invalid"),""==t.purchase_member&&$("#purchase-member").addClass("is-invalid"),""==t.purchase_sharing&&$("#purchase-sharing").addClass("is-invalid")}});var i=e.purchase.length,r=e.getMemberName(t.purchase_member),s=e.html.purchase.replace(/{{title}}/g,t.purchase_title).replace(/{{price}}/g,t.purchase_price).replace(/{{member}}/g,r).replace(/{{sharing}}/g,e.options.sharing[t.purchase_sharing]).replace(/{{idx}}/g,i);$("#purchase-list .empty").hide(),$("#purchase-list").append(s),e.purchase.push({idx:i,title:t.purchase_title,price:t.purchase_price,member:t.purchase_member,sharing:t.purchase_sharing}),$("#purchase-title, #purchase-price, #purchase-member, #purchase-sharing").val(""),e.updateMemberCost(),e.updateTotal()}),$(document).on("click","#purchase-list .group .delete",function(){var t=this;showConfirm({title:"是否要刪除此消費記錄？",then:function(){var i=$(t).data("idx");e.purchase.forEach(function(r,s){r.idx==i&&($(t).closest(".group").remove(),e.purchase.splice(s,1))}),0==e.purchase.length&&$("#purchase-list .empty").show(),e.updatePurchaseMemberOptions(),e.updateMemberCost(),e.updateTotal()}})})}},{key:"updatePurchaseMemberOptions",value:function(){$("#purchase-member option").each(function(e,t){0!=e&&$(this).remove()}),this.members.forEach(function(e){var t='<option value="'+e.idx+'">'+e.title+"</option>";$("#purchase-member").append(t)})}},{key:"getMemberName",value:function(e){var t="";return this.members.forEach(function(i){i.idx==e&&(t=i.title)}),t}},{key:"cleanPurchase",value:function(e){var t=this;this.purchase.forEach(function(i,r){e==i.member&&(t.purchase.splice(r,1),$("#purchase-list .group").eq(r).remove())}),0==this.purchase.length&&$("#purchase-list .empty").show(),this.updateTotal()}},{key:"updateMemberCost",value:function(){var e=this,t=0;if($(".member-cost").html(""),this.members.length>0){var i="";this.members.forEach(function(r,s){i+='<h6 class="mb-2">'+r.title+'：<span id="cost-'+r.idx+'">0</span></h6>',e.members[s].cost=0,e.members[s].pay=0,t+=parseInt(r.qty)}),$(".member-cost").html(i)}if(this.purchase.length>0){var r=0,s=0;this.purchase.forEach(function(t){switch(t.sharing){case 0:case"0":r+=parseInt(t.price);break;case 1:case"1":s+=parseInt(t.price)}e.members.forEach(function(i,r){i.idx==t.member&&(e.members[r].cost+=parseInt(t.price))})}),this.members.forEach(function(i,a){$("#cost-"+i.idx).text(i.cost),e.members[a].pay+=Math.round(r/t)*i.qty+Math.round(s/e.members.length)-i.cost});var a=[];for(var o in this.members)if(this.members[o].pay<0)for(var n in this.members)if(this.members[n].idx!=this.members[o].idx&&this.members[n].pay>0&&this.members[o].pay<0){var c=this.members[o].pay+this.members[n].pay;c>0?(a.push({from:this.members[n].title,to:this.members[o].title,price:Math.abs(this.members[o].pay)}),this.members[o].pay=0,this.members[n].pay=c):(a.push({from:this.members[n].title,to:this.members[o].title,price:Math.abs(this.members[n].pay)}),this.members[o].pay=c,this.members[n].pay=0)}if(a.length>0){var l="";a.forEach(function(t){l+=e.html.history.replace(/{{from}}/g,t.from).replace(/{{to}}/g,t.to).replace(/{{price}}/g,t.price)}),$("#sharing-result .group").remove(),$("#sharing-result .empty").hide().before(l)}else $("#sharing-result .empty").show().siblings(".group").remove()}localStorage.setItem("memory",JSON.stringify(this))}},{key:"updateTotal",value:function(){var e=0;this.purchase.forEach(function(t){e+=parseInt(t.price)}),$("#total").text(e)}},{key:"resetHtml",value:function(){$("#member-list .empty, #purchase-list .empty, #sharing-result .empty").show().siblings(".group").remove()}}]),e}();$(function(){var e=localStorage.getItem("memory");window.action=new AccountSharing(JSON.parse(e))});